/*
 * This file is part of Kubriko.
 * Copyright (c) Pandula PÃ©ter 2025.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
 * If a copy of the MPL was not distributed with this file, You can obtain one at
 * https://mozilla.org/MPL/2.0/.
 */
package com.pandulapeter.kubriko.audioPlayback.implementation

import kotlinx.collections.immutable.PersistentMap
import kotlinx.coroutines.DelicateCoroutinesApi
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.GlobalScope
import kotlinx.coroutines.launch

@OptIn(DelicateCoroutinesApi::class)
internal actual fun MusicPlayer.onManagerDisposed(cache: PersistentMap<String, Any?>) {
    GlobalScope.launch(Dispatchers.Default) {
        cache.values.filterNotNull().forEach { music -> dispose(music) }
        dispose()
    }
}